<!-- Month navigation -->
<div class="flex items-center justify-center gap-5 mb-8">
    <button
        class="w-8 h-8 rounded-lg border border-sand-300 flex items-center justify-center text-ink-tertiary hover:text-ink-secondary hover:bg-sand-200/60 transition-colors"
        hx-get="/htmx/stats/{{ prev_year }}/{{ prev_month }}"
        hx-target="#stats-content"
        hx-swap="innerHTML"
    >
        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
    </button>
    <span class="text-[15px] font-medium text-ink min-w-[160px] text-center">{{ month|month_name }} {{ year }}</span>
    {% if not is_current_month %}
    <button
        class="w-8 h-8 rounded-lg border border-sand-300 flex items-center justify-center text-ink-tertiary hover:text-ink-secondary hover:bg-sand-200/60 transition-colors"
        hx-get="/htmx/stats/{{ next_year }}/{{ next_month }}"
        hx-target="#stats-content"
        hx-swap="innerHTML"
    >
        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
    </button>
    {% else %}
    <div class="w-8 h-8 rounded-lg border border-sand-200 flex items-center justify-center text-ink-faint cursor-not-allowed">
        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
    </div>
    {% endif %}
</div>

<!-- Stat counters -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">Всего</div>
        <div class="text-2xl font-medium text-ink tabular-nums">{{ stats.total }}</div>
    </div>
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">Выполнено</div>
        <div class="text-2xl font-medium text-[#4a8a5c] tabular-nums">{{ stats.completed }}</div>
    </div>
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">В процессе</div>
        <div class="text-2xl font-medium text-ink tabular-nums">{{ stats.in_progress + stats.finished }}</div>
    </div>
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">Отменено</div>
        <div class="text-2xl font-medium text-[#b5564e] tabular-nums">{{ stats.cancelled }}</div>
    </div>
</div>

<!-- Amounts -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">Общая сумма</div>
        <div class="text-xl font-medium text-ink tabular-nums">${{ "%.0f"|format(stats.total_amount) }}</div>
    </div>
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">Средняя сумма</div>
        <div class="text-xl font-medium text-ink tabular-nums">${{ "%.0f"|format(stats.avg_amount) }}</div>
    </div>
    <div class="border border-sand-300 rounded-xl p-4 bg-white/40">
        <div class="text-2xs text-ink-muted uppercase tracking-wider mb-2">Просрочено</div>
        <div class="text-xl font-medium tabular-nums {{ 'text-[#b5564e]' if stats.overdue > 0 else 'text-ink' }}">{{ stats.overdue }}</div>
    </div>
</div>

<!-- Platforms -->
{% if stats.platforms %}
<div>
    <h3 class="text-[15px] font-medium text-ink mb-4">Платформы</h3>
    <div class="border border-sand-300 rounded-xl overflow-hidden bg-white/40">
        <table class="w-full">
            <thead>
                <tr class="border-b border-sand-300/60">
                    <th class="text-left text-2xs font-medium text-ink-muted uppercase tracking-wider px-5 py-3">Платформа</th>
                    <th class="text-left text-2xs font-medium text-ink-muted uppercase tracking-wider px-5 py-3">Заказов</th>
                    <th class="text-left text-2xs font-medium text-ink-muted uppercase tracking-wider px-5 py-3">Сумма</th>
                </tr>
            </thead>
            <tbody>
                {% for name, data in stats.platforms.items() %}
                <tr class="border-b border-sand-200 last:border-0 hover:bg-sand-100/50 transition-colors">
                    <td class="px-5 py-3 text-sm text-ink">{{ name|platform_label }}</td>
                    <td class="px-5 py-3 text-sm text-ink-secondary tabular-nums">{{ data.count }}</td>
                    <td class="px-5 py-3 text-sm text-ink font-medium tabular-nums">${{ "%.0f"|format(data.amount) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{% if stats.total == 0 %}
<div class="flex flex-col items-center justify-center min-h-[20vh]">
    <p class="text-ink-muted text-sm">Нет данных за этот месяц</p>
</div>
{% endif %}
